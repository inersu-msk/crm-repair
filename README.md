# üîß CRM - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –Ω–∞ —Ä–µ–º–æ–Ω—Ç

–ü—Ä–æ—Å—Ç–∞—è –∏ —É–¥–æ–±–Ω–∞—è CRM —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–≤ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ —Ä–µ–º–æ–Ω—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìã **–ö–∞–Ω–±–∞–Ω-–¥–æ—Å–∫–∏** - –æ—Ç–¥–µ–ª—å–Ω–∞—è –¥–æ—Å–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞
- üîÑ **Drag-and-drop** - –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –º–µ–∂–¥—É —Å—Ç–∞—Ç—É—Å–∞–º–∏
- üë®‚Äçüîß **–£—á—ë—Ç –º–∞—Å—Ç–µ—Ä–æ–≤** - –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ –Ω–∏–∫—É –≤ Telegram
- üí∞ **–§–∏–Ω–∞–Ω—Å—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç 50/50 –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∑–∞–∫–∞–∑–∞
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∑–∞ –¥–µ–Ω—å, –Ω–µ–¥–µ–ª—é, –º–µ—Å—è—Ü –∏ –≤—Å—ë –≤—Ä–µ–º—è
- üîê **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - JWT —Ç–æ–∫–µ–Ω—ã, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—Ö–æ–¥
- üì± **–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è** - PWA, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- üîç **–ü–æ–∏—Å–∫** - –ø–æ –∞–¥—Ä–µ—Å—É, —Ç–µ–ª–µ—Ñ–æ–Ω—É, –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
cd —Å—Ä–º
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª
cp .env.example .env
```

–í–∞–∂–Ω–æ: –∏–∑–º–µ–Ω–∏—Ç–µ `JWT_SECRET` –Ω–∞ —Å–≤–æ–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á!

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

```bash
npm run dev
```

### 4. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

```
http://localhost:3000
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ —Å–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å).

## ‚ö° –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (Ubuntu)

**–û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ - –∏ –≤—Å—ë –≥–æ—Ç–æ–≤–æ:**

```bash
curl -sSL https://raw.githubusercontent.com/inersu-msk/crm-repair/main/install.sh | sudo bash
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Node.js 20
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Nginx
- ‚úÖ –°–∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –≤ `/var/www/crm`
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç systemd —Å–µ—Ä–≤–∏—Å
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Nginx
- ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π JWT_SECRET

## üñ•Ô∏è –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π –Ω–∞ Ubuntu —Å–µ—Ä–≤–µ—Ä

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ build-essential –¥–ª—è native –º–æ–¥—É–ª–µ–π
sudo apt install -y build-essential python3

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx
sudo apt install -y nginx

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ certbot –¥–ª—è SSL
sudo apt install -y certbot python3-certbot-nginx
```

### 2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
sudo mkdir -p /var/www/crm
sudo chown $USER:$USER /var/www/crm

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã (—á–µ—Ä–µ–∑ scp, git –∏–ª–∏ –≤—Ä—É—á–Ω—É—é)
# scp -r ./* user@server:/var/www/crm/
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
cd /var/www/crm
npm install --production
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env

```bash
cp .env.example .env
nano .env
```

–ò–∑–º–µ–Ω–∏—Ç–µ:
- `JWT_SECRET` - —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–∞–¥—ë–∂–Ω—ã–π –∫–ª—é—á: `openssl rand -hex 32`
- `PORT` - –ø–æ—Ä—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3000)

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞

```bash
# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª —Å–µ—Ä–≤–∏—Å–∞
sudo cp deploy/crm.service /etc/systemd/system/

# –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
sudo nano /etc/systemd/system/crm.service

# –í–∫–ª—é—á–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º
sudo systemctl daemon-reload
sudo systemctl enable crm
sudo systemctl start crm

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
sudo systemctl status crm
```

### 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

```bash
# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥
sudo cp deploy/nginx.conf /etc/nginx/sites-available/crm

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –¥–æ–º–µ–Ω
sudo nano /etc/nginx/sites-available/crm
# –ó–∞–º–µ–Ω–∏—Ç–µ your-domain.com –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω

# –°–æ–∑–¥–∞—ë–º —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É
sudo ln -s /etc/nginx/sites-available/crm /etc/nginx/sites-enabled/

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º Nginx
sudo systemctl reload nginx
```

### 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL (HTTPS)

```bash
# –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --nginx -d your-domain.com

# Certbot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ñ–∏–≥ Nginx
```

### 8. –ì–æ—Ç–æ–≤–æ!

–û—Ç–∫—Ä–æ–π—Ç–µ `https://your-domain.com` –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
—Å—Ä–º/
‚îú‚îÄ‚îÄ server.js          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ database.js        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SQLite
‚îú‚îÄ‚îÄ package.json       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env               # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ routes/            # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ auth.js
‚îÇ   ‚îú‚îÄ‚îÄ cities.js
‚îÇ   ‚îú‚îÄ‚îÄ orders.js
‚îÇ   ‚îú‚îÄ‚îÄ masters.js
‚îÇ   ‚îú‚îÄ‚îÄ sources.js
‚îÇ   ‚îú‚îÄ‚îÄ statuses.js
‚îÇ   ‚îî‚îÄ‚îÄ stats.js
‚îú‚îÄ‚îÄ middleware/        # Middleware
‚îÇ   ‚îî‚îÄ‚îÄ auth.js
‚îú‚îÄ‚îÄ public/            # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json
‚îÇ   ‚îú‚îÄ‚îÄ sw.js
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ style.css
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ api.js
‚îÇ       ‚îú‚îÄ‚îÄ kanban.js
‚îÇ       ‚îî‚îÄ‚îÄ app.js
‚îú‚îÄ‚îÄ data/              # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ crm.db
‚îî‚îÄ‚îÄ deploy/            # –§–∞–π–ª—ã –¥–ª—è –¥–µ–ø–ª–æ—è
    ‚îú‚îÄ‚îÄ nginx.conf
    ‚îî‚îÄ‚îÄ crm.service
```

## üîß API Endpoints

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `POST /api/auth/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- `POST /api/auth/login` - –≤—Ö–æ–¥
- `GET /api/auth/me` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
- `GET /api/auth/check` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω—É–∂–Ω–∞ –ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

### –ì–æ—Ä–æ–¥–∞
- `GET /api/cities` - —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤
- `POST /api/cities` - –¥–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥
- `PUT /api/cities/:id` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- `DELETE /api/cities/:id` - —É–¥–∞–ª–∏—Ç—å

### –ó–∞–∫–∞–∑—ã
- `GET /api/orders/city/:cityId` - –∑–∞–∫–∞–∑—ã –ø–æ –≥–æ—Ä–æ–¥—É
- `GET /api/orders/search?q=` - –ø–æ–∏—Å–∫
- `POST /api/orders` - —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- `PUT /api/orders/:id` - –æ–±–Ω–æ–≤–∏—Ç—å
- `PUT /api/orders/:id/status` - –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
- `PUT /api/orders/:id/close` - –∑–∞–∫—Ä—ã—Ç—å —Å —Å—É–º–º–æ–π
- `DELETE /api/orders/:id` - —É–¥–∞–ª–∏—Ç—å

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/stats/overview` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/stats/masters?period=` - –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º
- `GET /api/stats/sources?period=` - –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

## üíæ –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `data/crm.db`. –î–ª—è –±—ç–∫–∞–ø–∞ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª:

```bash
# –ë—ç–∫–∞–ø
cp /var/www/crm/data/crm.db /backup/crm-$(date +%Y%m%d).db

# –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø —á–µ—Ä–µ–∑ cron
crontab -e
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É (–±—ç–∫–∞–ø –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2 –Ω–æ—á–∏):
# 0 2 * * * cp /var/www/crm/data/crm.db /backup/crm-$(date +\%Y\%m\%d).db
```

## üì± –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω (PWA)

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ Chrome/Safari
2. –í –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–±–µ—Ä–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω"
3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## üõ†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ better-sqlite3

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ build-essential
sudo apt install -y build-essential python3
npm rebuild better-sqlite3
```

### –ü–æ—Ä—Ç 3000 –∑–∞–Ω—è—Ç

–ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ `.env` —Ñ–∞–π–ª–µ –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ —ç—Ç–æ–º –ø–æ—Ä—Ç—É:
```bash
lsof -i :3000
kill -9 <PID>
```

### –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

```bash
sudo chown -R www-data:www-data /var/www/crm
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
